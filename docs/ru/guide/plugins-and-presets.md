# Плагины и пресеты настроек

## Плагины

Архитектура Vue CLI основана на плагинах. Если вы изучите в только что созданном проекте `package.json`, вы найдёте зависимости, чьи имена начинаются с `@vue/cli-plugin-`. Плагины могут изменять внутреннюю конфигурацию webpack и внедрять команды в `vue-cli-service`. Большинство возможностей, упоминаемых при создании проекта реализованы плагинами.

Архитектура основанная на плагинах позволяет Vue CLI оставаться гибким и расширяемым. Если вы хотите создать собственный плагин — изучите [руководство по созданию плагинов](../dev-guide/plugin-dev.md).

::: tip Совет
Вы можете устанавливать и управлять плагинами в GUI с помощью команды `vue ui`.
:::

### Установка плагинов в существующий проект

Каждый плагин для CLI поставляется с генератором (который создаёт файлы) и плагином для runtime (который меняет конфигурацию webpack и внедряет команды). Когда вы используете `vue create` для создания нового проекта некоторые плагины будут предустановлены, основываясь на вашем выборе необходимых возможностей. В случае, если вы хотите установить плагин в уже существующий проект, вы должны сделать это командой `vue add`:

``` bash
vue add @vue/eslint
```

::: tip Совет
`vue add` специально разработана для установки и запуска плагинов для Vue CLI. Это не означает, что команда заменяет обычные npm пакеты. Для обычных npm пакетов вы должны по-прежнему использовать менеджер пакетов который используете.
:::

::: warning Предупреждение
Рекомендуется закоммитить все текущие изменения в вашем проекте перед запуском `vue add`, поскольку команда запустит генератор файлов плагина и возможно выполнит изменения в уже существующих файлах.
:::

Команда трансформирует `@vue/eslint` в полное имя пакета `@vue/cli-plugin-eslint`, устанавливает его из npm, и запускает его генератор.

``` bash
# это аналогично предыдущему вызову
vue add @vue/cli-plugin-eslint
```

Без префикса `@vue` команда будет трансформировать название к публичному пакету. Например, чтобы установить сторонний плагин `vue-cli-plugin-apollo`:

``` bash
# устанавливает и запускает vue-cli-plugin-apollo
vue add apollo
```

Вы можете также использовать сторонние плагины со специфичным scope. Например, если плагин назван `@foo/vue-cli-plugin-bar`, то его можно добавить командой:

``` bash
vue add @foo/bar
```

Можно передавать опции генерации в установленный плагин (для пропуска подсказок выбора):

``` bash
vue add @vue/eslint --config airbnb --lintOn save
```

Добавление `vue-router` и `vuex` — особый случай, у них нет собственных плагинов, но вы тем не менее можете их добавить:

``` bash
vue add router
vue add vuex
```

Если плагин уже установлен, вы можете пропустить установку и только вызвать его генератор с помощью команды `vue invoke`. Команда принимает такие же аргументы, как и `vue add`.

::: tip Совет
Если по какой-либо причине ваши плагины перечислены в файле `package.json`, отличном от файла, расположенного в вашем проекте, вы можете установить опцию `vuePlugins.resolveFrom` в файле `package.json` проекта с указанием пути к каталогу, содержащему другой файл `package.json`.

Например, если у вас есть файл `.config/package.json`:

```json
{
  "vuePlugins": {
    "resolveFrom": ".config"
  }
}
```
:::

### Локальный плагин проекта

Если требуется доступ к API плагина в вашем проекте и вы не хотите создавать полноценный плагин для этого, можно использовать опцию `vuePlugins.service` в файле `package.json`:

```json
{
  "vuePlugins": {
    "service": ["my-commands.js"]
  }
}
```

Каждому файлу необходимо экспортировать функцию, принимающую API плагина первым аргументом. Для получения дополнительной информации об API плагина, ознакомьтесь с [руководством по разработке плагинов](../dev-guide/plugin-dev.md).

Вы можете добавить файлы, которые будут вести себя как плагины UI опцией `vuePlugins.ui`:

```json
{
  "vuePlugins": {
    "ui": ["my-ui.js"]
  }
}
```

Для получения дополнительной информации, ознакомьтесь с [API плагина для UI](../dev-guide/ui-api.md).

## Пресеты настроек

Пресет настроек для Vue CLI — JSON-объект, который содержит предустановленные опции и плагины для создания нового проекта, чтобы пользователю не приходилось проходить через цепочку вопросов для их выбора.

Пресеты сохраняемые во время `vue create` создаются в конфигурационном файле в домашнем каталоге пользователя (`~/.vuerc`). Вы можете напрямую изменять этот файл для внесения правок / добавления / удаление сохранённых пресетов.

Вот пример пресета настроек:

``` json
{
  "useConfigFiles": true,
  "router": true,
  "vuex": true,
  "cssPreprocessor": "sass",
  "plugins": {
    "@vue/cli-plugin-babel": {},
    "@vue/cli-plugin-eslint": {
      "config": "airbnb",
      "lintOn": ["save", "commit"]
    }
  }
}
```

Информация из пресета настроек используется генераторами плагинов для создания соответствующих файлов проекта. В дополнении к полям выше, вы также можете добавлять дополнительную конфигурацию для встроенных инструментов:

``` json
{
  "useConfigFiles": true,
  "plugins": {...},
  "configs": {
    "vue": {...},
    "postcss": {...},
    "eslintConfig": {...},
    "jest": {...}
  }
}
```

Эти дополнительные конфигурации будут объединены в `package.json` или соответствующие файлы конфигураций, основываясь на значении `useConfigFiles`. Например, при указании `"useConfigFiles": true`, значение `configs.vue` будет объединено в файл `vue.config.js`.

### Версии плагинов в пресете

Вы можете явно указать версии используемых плагинов:

``` json
{
  "plugins": {
    "@vue/cli-plugin-eslint": {
      "version": "^3.0.0",
      // ... другие настройки для этого плагина
    }
  }
}
```

Обратите внимание, это не требуется для официальных плагинов — если не указано, то CLI будет автоматически использовать последнюю версию, доступную в регистре. Тем не менее, **рекомендуется указывать явный диапазон версий для любых сторонних плагинов, перечисленных в пресете**.

### Добавление запрашивания выбора у пользователя

Каждый плагин может запрашивать выбор у пользователя на этапе создания проекта, но при использовании пресеты, все эти запросы пользователю будут пропущены, потому что Vue CLI подразумевает что все настройки плагина уже объявлены в пресете.

В некоторых случаях может возникнуть потребность, чтобы пресет только объявлял необходимые плагины, оставляя при этом некоторую гибкость настройки, запрашивая у пользователя выбор из вариантов, предоставляемых плагином.

Для таких сценариев вы можете указать `"prompts": true` в настройках плагина, чтобы разрешить ему запрашивать выбор пользователя:

``` json
{
  "plugins": {
    "@vue/cli-plugin-eslint": {
      // разрешаем пользователю выбрать свою конфигурацию ESLint
      "prompts": true
    }
  }
}
```

### Пресет из удалённого репозитория

Вы можете поделиться пресетом с другими разработчиками, опубликовав его в git репозитории. Репозиторий должен содержать файл `preset.json`, в котором будет указана конфигурация пресета. Затем вы можете использовать опцию `--preset`, чтобы использовать пресет из удалённого репозитория при создании проекта:

``` bash
# использование пресета из репозитория GitHub
vue create --preset username/repo my-project
```

GitLab и BitBucket также поддерживаются. Убедитесь, что используете опцию `--clone` при загрузке из стороннего репозитория:

``` bash
vue create --preset gitlab:username/repo --clone my-project
vue create --preset bitbucket:username/repo --clone my-project
```

### Пресет из локального файла

Разрабатывая удалённый пресет настроек, может потребоваться многократно отправлять пресет в удалённый репозиторий для его проверки. Для упрощения разработки флаг `--preset` также принимает локальные `.json` файлы:

``` bash
vue create --preset local.json my-project
```
