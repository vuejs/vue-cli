<template>
  <div class="vulnerability-item list-item">
    <div class="wrapper">
      <ItemLogo
        image="error"
        :class="severity.class"
      />

      <ListItemInfo
        :link="item.moreInfo"
      >
        <template slot="name">
          <span class="name">{{ item.name }}</span>
          <span class="version">{{ item.version }}</span>
        </template>

        <template slot="description">
          <span
            class="severity"
            :class="severity.class"
          >
            {{ $t(`org.vue.widgets.vulnerability.severity.${item.severity}`) }}
          </span>

          <span class="message">
            {{ item.message }}
          </span>
        </template>
      </ListItemInfo>

      <div class="parents">
        <div v-if="!item.parents" class="vue-ui-empty">
          {{ $t('org.vue.widgets.vulnerability.direct-dep') }}
        </div>

        <template v-else>
          <div
            v-for="(parent, index) of item.parents"
            :key="index"
            class="parent"
          >
            <span class="name">{{ parent.name }}</span>
            <span class="version">{{ parent.version }}</span>
            <VueIcon
              icon="chevron_right"
              class="separator-icon medium"
            />
          </div>
          <div class="parent current">
            <span class="name">{{ item.name }}</span>
            <span class="version">{{ item.version }}</span>
          </div>
        </template>
      </div>
    </div>
  </div>
</template>

<script>
const SEVERITIES = {
  high: {
    class: 'danger'
  },
  medium: {
    class: 'warning'
  },
  low: {
    class: ''
  }
}

export default {
  props: {
    item: {
      type: Object,
      required: true
    }
  },

  computed: {
    severity () {
      return SEVERITIES[this.item.severity]
    }
  }
}
</script>

<style lang="stylus" scoped>
@import "~@vue/cli-ui/src/style/imports"

.vulnerability-item
  padding $padding-item
  border-top solid 1px rgba($color-text-light, .2)

.wrapper
  h-box()
  box-center()

.list-item-info
  flex 1

  .name
    font-weight bold

.version
  margin-left 4px
  font-family monospace
  font-size .9em

.severity
  color $color-text-light
  &.danger
    color $vue-ui-color-danger
  &.warning
    color $vue-ui-color-warning

.parents
  h-box()

.separator-icon
  >>> svg
    fill $color-text-light

.vue-ui-empty
  padding 0
</style>
